/*! Facebook Friend Search - v0.1.4 - 2013-04-24
* https://github.com/hatchddigital/fbfs
* Copyright (c) 2013 Hatchd Digital; Licensed MIT */
window.FBFS=function(e){"use strict";var t=function(n,r){var i=this;this.options=e.extend({onUserSelect:!1,user_limit:10,userTemplate:this.userTemplate,autoclose:!0},r),this.$element=e(n),this.$element.find(".facebook-friends").addClass("state-empty"),this.$element.find(".facebook-friends").addClass("state-empty");var s=this.$element.find(".search"),o=this.$element.find(".search-clearinput");return s.on("keyup",function(){i.onSearch(e(this).val())}),o.on("click",function(){s.val("").trigger("keyup")}),this};return t.prototype.onSearch=function(n,r){var i=this,s=this.searchUsersFQL({name:n.toLowerCase(),limit:i.options.user_limit}),o=e('<ul class="facebook-friends"></ul>'),u=this.$element.find(".facebook-friends"),a=++i.current_request;if(!n.length){u.replaceWith(o),i.$element.find(".facebook-friends").addClass("state-empty");return}i.$element.addClass("state-searching"),FB.api({method:"fql.query",query:s},function(t){var n,s,f;if(i.current_request!==a)return;if(typeof t.error_code=="string")return typeof r=="function"&&r.call(i,"onSearch"),!1;i.$element.removeClass("state-searching");if(t.length){i.$element.find(".facebook-friends").removeClass("state-empty");for(s=t.length-1;s>=0;s--)n=e(i.options.userTemplate(t[s])),n.data("user",t[s]),o.append(n);u.replaceWith(o)}else i.$element.find(".facebook-friends").addClass("state-empty");f=i.options.onUserSelect,o.find("li").on("click",function(t){t.preventDefault(),f&&typeof f=="function"&&f.call(i,e(this).data("user"),t),i.options.autoclose&&o.html("")})})},t.prototype.userTemplate=Handlebars.compile('<li class="fbfs-user"><button type="button" id="{{uid}}" class="fb-name"><img alt="Portrait of {{name}}" class="fb-profileimg" src="https://graph.facebook.com/{{uid}}/picture" />{{name}}</button></li>'),t.prototype.searchUsersFQL=Handlebars.compile("SELECT uid, username, first_name, last_name, name FROM user WHERE uid IN (SELECT uid2  FROM friend  WHERE uid1 = me()) AND strpos(lower(name),'{{name}}') >= 0LIMIT {{limit}}"),e.fn.fbfs=function(e){e=e||{},this.each(function(){return new t(this,e)})},t}(jQuery);