/*! Facebook Friend Search - v0.1.0 - 2013-03-26
* https://github.com/hatchddigital/fbfs
* Copyright (c) 2013 Hatchd Digital; Licensed MIT */
window.FBFS=function(e){var t=function(n,r){var i=this;this.options=e.extend({onUserSelect:!1,user_limit:10,userTemplate:this.userTemplate},r),this.$element=e(n),i.$element.find(".facebook-friends").addClass("state-empty");var s=this.$element.find(".search");return s.on("keyup",function(){i.onSearch(e(this).val())}),this};return t.prototype.onSearch=function(n){var r=this,i=this.FQL_SEARCH({name:n.toLowerCase(),limit:r.options.user_limit}),s=e('<ul class="facebook-friends"></ul>'),o=this.$element.find(".facebook-friends");n.length||r.$element.find(".facebook-friends").addClass("state-empty"),r.$element.find(".search").addClass("state-searching"),FB.api({method:"fql.query",query:i},function(t){var n,i,u;if(typeof t.error_code=="string")return!1;r.$element.find(".search").removeClass("state-searching");if(t.length){r.$element.find(".facebook-friends").removeClass("state-empty");for(i=t.length-1;i>=0;i--)n=e(r.options.userTemplate(t[i])),n.data("user",t[i]),s.append(n);o.replaceWith(s)}else r.$element.find(".facebook-friends").addClass("state-empty");u=r.options.onUserSelect,s.find("li").on("click",function(){u&&typeof u=="function"&&u.call(r,e(this).data("user"))})})},t.prototype.userTemplate=Handlebars.compile('<li class="fbfs-user"><img alt="Portrait of {{name}}" class="fb-profileimg" src="https://graph.facebook.com/{{uid}}/picture" /><a id="{{uid}}" class="fb-name" href="#">{{name}}</a></li>'),t.prototype.FQL_SEARCH=Handlebars.compile("SELECT uid, username, first_name, last_name, name FROM user WHERE uid IN (SELECT uid2  FROM friend  WHERE uid1 = me()) AND strpos(lower(name),'{{name}}') >= 0LIMIT {{limit}}"),e.fn.fbfs=function(e){e=e||{},this.each(function(){var n=new t(this,e)})},t}(jQuery);